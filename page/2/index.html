<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/19/Java%E5%9F%BA%E7%A1%80%E5%BC%BA%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%20--%20%E5%8F%8D%E5%B0%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/19/Java%E5%9F%BA%E7%A1%80%E5%BC%BA%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%20--%20%E5%8F%8D%E5%B0%84/" class="post-title-link" itemprop="url">Java基础强化（一） -- 反射</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-19 14:00:55" itemprop="dateCreated datePublished" datetime="2020-02-19T14:00:55+08:00">2020-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-20 08:47:35" itemprop="dateModified" datetime="2020-02-20T08:47:35+08:00">2020-02-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java基础强化（一）-–-反射"><a href="#Java基础强化（一）-–-反射" class="headerlink" title="Java基础强化（一） – 反射"></a>Java基础强化（一） – 反射</h1><p>​        在学习完MyBatis与Spring技术之后，笔者决定先去巩固一些之前不牢固的java以及javaWeb基础。主要内容包括：反射、注解、并发与线程、servlet、request、response、EL表达式、JSTL、监听器、过滤器、Maven。在扎实基础之后，再前往学习Spring的后续内容。</p>
<h2 id="一、反射概述"><a href="#一、反射概述" class="headerlink" title="一、反射概述"></a>一、反射概述</h2><p>​        1.反射：框架设计的灵魂</p>
<pre><code>框架：半成品软件。在框架的基础上开发，可以简化编码。

反射：将类的各个组成部分封装为其他对象，这就是反射机制  </code></pre><p>​        2.好处：</p>
<p>​                （1）便于程序在运行过程中操作这些对象。</p>
<p>​                （2）可以解耦，提高程序的可扩展性</p>
<p>​        3.获取Class对象的方法:</p>
<p>​                （1）Class.forName(“全类名”)：将字节码加载进内存，返回Class对象</p>
<p>​                            <em>多用于配置文件，将全类名定义在配置文件中。读取文件，加载类即可</em></p>
<p>​                （2）类名.class:通过类名的属性class获取</p>
<p>​                            <em>多用于参数的传递</em></p>
<p>​                （3）对象.getClass():getClass是Object类中的方法</p>
<p>​                            <em>多用于凭借对象获取字节码</em>    </p>
<p>​                <strong>同一个字节码文件(*.class)在一次运行过程中，只会被加载一次，不论通过上述哪种方式获取class对象，结果都是同一个</strong></p>
<h2 id="二、Class对象的功能"><a href="#二、Class对象的功能" class="headerlink" title="二、Class对象的功能"></a>二、Class对象的功能</h2><p>​    1.获取成员变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*返回一个Filed对象数组，保存本类及其父类的public成员变量*/</span></span><br><span class="line">Field [] getFields();</span><br><span class="line"><span class="comment">/*返回一个Filed对象，该对象是指定名称的本类或父类public成员变量*/</span></span><br><span class="line"><span class="function">Filed <span class="title">getFiled</span><span class="params">(String name)</span></span>;</span><br><span class="line"><span class="comment">/*返回一个Filed对象数组，保存本类的任意访问权限的成员变量*/</span></span><br><span class="line">Filed [] getDeclaredFileds();</span><br><span class="line"><span class="comment">/*返回一个Filed对象，该对象是指定类名的本类的任意访问权限的成员变量*/</span></span><br><span class="line"><span class="function">Filed <span class="title">getDeclaredFiled</span><span class="params">(String name)</span> </span>;</span><br></pre></td></tr></table></figure>

<p>​    2.获取构造函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*返回Class对象类的所有public构造器*/</span></span><br><span class="line">Construcator [] getConstructors();</span><br><span class="line"><span class="comment">/*返回Class对象类中的指定名字的public构造器*/</span></span><br><span class="line"><span class="function">Constructor <span class="title">getConstructor</span><span class="params">(String name)</span></span>;</span><br><span class="line"><span class="comment">/*返回Class对象类中所有构造器*/</span></span><br><span class="line">Constructor [] getDeclaredConstructors();</span><br><span class="line"><span class="comment">/*返回Class对象类中指定名字的构造器*/</span></span><br><span class="line"><span class="function">Constructor <span class="title">getDeclaredConstructor</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​        实例程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建Teacher的Class对象类*/</span></span><br><span class="line">Class class5  = Class.forName(<span class="string">"domain.Teacher"</span>);</span><br><span class="line"><span class="comment">/*获取Teacher的所有构造函数*/</span></span><br><span class="line">Constructor []constructors = class5.getConstructors(); <span class="comment">//teacher中有两个构造函数</span></span><br><span class="line"><span class="comment">/*打印Teacher的所有构造函数*/</span></span><br><span class="line"><span class="keyword">for</span>(Constructor constructor : constructors)&#123;</span><br><span class="line">	System.out.println(constructor);</span><br><span class="line">&#125;	</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">public domain.Teacher()</span></span><br><span class="line"><span class="comment">public domain.Teacher(java.lang.String,java.lang.Integer)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<p>​     3.获取成员方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*获取Class对象类与其父类的所有public方法*/</span></span><br><span class="line">Method [] getMethods();</span><br><span class="line"><span class="comment">/*获取Class对象类与其父类的指定名称的public方法*/</span></span><br><span class="line"><span class="function">Method <span class="title">getMethod</span> <span class="params">(String name)</span></span>;</span><br><span class="line"><span class="comment">/*获取Class对象类的所有方法*/</span></span><br><span class="line">Method[] getDeclaredMethods()</span><br><span class="line"><span class="comment">/*获取Class对象类的指定名称的方法*/</span>;</span><br><span class="line"><span class="function">Method <span class="title">getDeclaredMethod</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​        实例程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建Teacher的Class对象类*/</span></span><br><span class="line">Class class5  = Class.forName(<span class="string">"domain.Teacher"</span>);</span><br><span class="line"><span class="comment">/*获取Teacher类中的无参teach方法*/</span></span><br><span class="line">Method method1 = class5.getMethod(<span class="string">"teach"</span>);</span><br><span class="line"><span class="comment">/*获取Teacher类中的有参teach方法*/</span></span><br><span class="line">Method method2 = class5.getMethod(<span class="string">"teach"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">/*打印Teacher类中的两个teach方法*/</span></span><br><span class="line">System.out.println(method1);</span><br><span class="line">System.out.println(method2);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	public void domain.Teacher.teach()</span></span><br><span class="line"><span class="comment">	public void domain.Teacher.teach(java.lang.String)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>  4.获取类名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、Filed类"><a href="#三、Filed类" class="headerlink" title="三、Filed类"></a>三、Filed类</h2><p>​        <strong>Filed类的常用方法</strong></p>
<p>​                (1) Object get(Object obj);</p>
<p>​                        获取obj对象中该成员变量的值.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建Teacher类的实例化对象teacher1*/</span></span><br><span class="line">Teacher teacher1 =  <span class="keyword">new</span> Teacher();</span><br><span class="line"><span class="comment">/*将teacher1中name的值设成"李老师"*/</span></span><br><span class="line">   teacher1.setName(<span class="string">"李老师"</span>);</span><br><span class="line"><span class="comment">/*获取Teacher的Class对象类*/</span></span><br><span class="line">   Class class0 = Class.forName(<span class="string">"domain.Teacher"</span>);</span><br><span class="line"><span class="comment">/*获取Teacher中的name成员变量*/</span></span><br><span class="line">   Field name = class0.getField(<span class="string">"name"</span>);</span><br><span class="line"><span class="comment">/*打印Teacher中的name成员变量*/</span></span><br><span class="line">   System.out.println(name.get(teacher1));</span><br><span class="line"><span class="comment">/*李老师*/</span></span><br></pre></td></tr></table></figure>



<p>​                (2) void set(Object obj,Object value);</p>
<p>​                        将obj对象中该成员变量的值设成value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">/*通过field的set方法将teacher1对象的name值设成"王老师"*/</span></span><br><span class="line">name.set(teacher1,<span class="string">"王老师"</span>);</span><br><span class="line"><span class="comment">/*打印Teacher中的name成员变量*/</span></span><br><span class="line">   System.out.println(name.get(teacher1));</span><br><span class="line"><span class="comment">/*王老师*/</span></span><br></pre></td></tr></table></figure>

<p>​                (3)setAccessible(boolean flag);</p>
<p>​                        若程序要访问私有成员变量的值，则需要通过本函数进行访问权限设置，即暴力反射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*将对象teacher1的age值设成40*/</span></span><br><span class="line">teacher1.setAge(<span class="number">40</span>);</span><br><span class="line"><span class="comment">/*获取Teacher中的age成员变量*/</span></span><br><span class="line">   Field age = class.getDeclaredField("age");//age为私有变量，不能用getField函数</span><br><span class="line">   age.setAccessible(<span class="keyword">true</span>);<span class="comment">//暴力反射</span></span><br><span class="line"><span class="comment">/*打印teacher1对象中age的值*/</span></span><br><span class="line">   System.out.println(age.get(teacher1)); <span class="comment">//40</span></span><br></pre></td></tr></table></figure>

<h2 id="四、Constructor类"><a href="#四、Constructor类" class="headerlink" title="四、Constructor类"></a>四、Constructor类</h2><p>​        <strong>Constructor类中的常用方法</strong></p>
<p>​                （1）newInstance（Object…  initargs）</p>
<p>​                            根据构造器构造对象，参数为构造器所需参数</p>
<p>​                    示例程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/*获取无参构造函数*/</span></span><br><span class="line">Constructor constructor = class5.getConstructor();</span><br><span class="line"><span class="comment">/*用无参构造函数创建Teacher对象*/</span></span><br><span class="line">   Teacher teacher2 = (Teacher) constructor.newInstance();</span><br><span class="line"><span class="comment">/*获取双参构造函数*/</span></span><br><span class="line">   Constructor constructor1 = class5.getConstructor(String<span class="class">.<span class="keyword">class</span>,<span class="title">Integer</span>.<span class="title">class</span>)</span>;</span><br><span class="line">   <span class="comment">/*用双参构造函数创建Teacher对象*/</span></span><br><span class="line">Teacher teacher3 = (Teacher) constructor1.newInstance(<span class="string">"李老师"</span>,<span class="number">40</span>);</span><br><span class="line"><span class="comment">/*打印结果*/</span></span><br><span class="line">   System.out.println(teacher2);</span><br><span class="line">   System.out.println(teacher3);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Teacher&#123;name='null', age=null&#125;		</span></span><br><span class="line"><span class="comment">Teacher&#123;name='李老师', age=40&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="五、Method类"><a href="#五、Method类" class="headerlink" title="五、Method类"></a>五、Method类</h2><p>​        <strong>Method类中的常用方法</strong></p>
<p>​                （1）invoke(Object obj,Object…  initargs)</p>
<p>​                            执行被获取的方法，参数为执行该方法的对象，以及方法所需要的参数</p>
<p>​                示例程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*获取无参构造函数*/</span></span><br><span class="line">Constructor constructor = class5.getConstructor();</span><br><span class="line"><span class="comment">/*用无参构造函数创建Teacher对象*/</span></span><br><span class="line">   Teacher teacher2 = (Teacher) constructor.newInstance();</span><br><span class="line"><span class="comment">/*获取双参构造函数*/</span></span><br><span class="line">   Constructor constructor1 = class5.getConstructor(String<span class="class">.<span class="keyword">class</span>,<span class="title">Integer</span>.<span class="title">class</span>)</span>;</span><br><span class="line">   <span class="comment">/*用双参构造函数创建Teacher对象*/</span></span><br><span class="line">Teacher teacher3 = (Teacher) constructor1.newInstance(<span class="string">"李老师"</span>,<span class="number">40</span>);</span><br><span class="line"><span class="comment">/*调用无参teach方法*/</span></span><br><span class="line">method1.invoke(teacher3);</span><br><span class="line"><span class="comment">/*调用有参teach方法*/</span></span><br><span class="line">method2.invoke(teacher3,<span class="string">"五年级一班"</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	上课中</span></span><br><span class="line"><span class="comment">	在五年级一班上课中</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>​                以上teach方法实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teach</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"上课中"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teach</span><span class="params">(String classroom)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"在"</span> + classroom + <span class="string">"上课中"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/18/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/" class="post-title-link" itemprop="url">Spring学习笔记（四）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-18 20:18:27 / 修改时间：20:17:12" itemprop="dateCreated datePublished" datetime="2020-02-18T20:18:27+08:00">2020-02-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring学习笔记（四）"><a href="#Spring学习笔记（四）" class="headerlink" title="Spring学习笔记（四）"></a>Spring学习笔记（四）</h1><p>​        今天的主要学习内容是通过aop实现Spring的自动事务配置。但Spring的自动事务配置需要使用JdbcTemplate进行持久层编写来配合使用。所以今日的学习内容主要分为了解JdbcTemplated的使用与掌握Spring自动事务配置</p>
<h2 id="一、JdbdTemplate"><a href="#一、JdbdTemplate" class="headerlink" title="一、JdbdTemplate"></a>一、JdbdTemplate</h2><p>​        *<em>1.概述 *</em></p>
<p>​            JdbcTemplate是Spring框架提供的一个对象，是对原始Jdbc API的一层简单封装。</p>
<p>​            JdbcTemplate对象类存在于spring-jdb-5.0.2.RELEASE.jar中,另外Spring的事务控制存在于spring-    tx-5.0.2.RELEASE.jar中</p>
<p>​        <strong>2.使用方法</strong></p>
<p>​                (1)在持久层中 使用JdbcTemplate对象进行数据的增删改查：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找一个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        List&lt;Account&gt; list = jdbcTemplate.query(<span class="string">"select * from account where id = ?"</span>,<span class="keyword">new</span> AccountRowMapper(),id);</span><br><span class="line">        <span class="keyword">return</span> list.isEmpty() ? <span class="keyword">null</span> : list.get(<span class="number">0</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存账户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> account</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"update account set money = ? where id = ?"</span>,account.getMoney(),account.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​                此处仅以增与查为例。jdbcTemplate的方法里需要提供的参数：sql语句，RowMapper对象，sql语句中的未知参数</p>
<p>​                其中RowMapper是一个接口，因此我们要自己实现一个AccountRowMapper，作为参数传入findById方法。RowMapper的主要作用是：用于指定数据库表属性与被封装对象属性对应关系，类似于MyBatis中的resultMap</p>
<p>​                (2)定义一个AccountRowMapper类，并编写mapRow方法            </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountRowMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Account</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">mapRow</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Account account = <span class="keyword">new</span> Account();</span><br><span class="line">        account.setName(resultSet.getString(<span class="string">"name"</span>));</span><br><span class="line">        account.setMoney(resultSet.getDouble(<span class="string">"money"</span>));</span><br><span class="line">        account.setId(resultSet.getInt(<span class="string">"id"</span>));</span><br><span class="line">        <span class="keyword">return</span> account ;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​                (3)配置jdbc的bean对象，并注入数据源。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置JdbcTemplate对象 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 注入数据源--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                (4)配置数据源（数据源目前有三种选择：C3P0，DBCP，spring内置数据源，此处使用第三种）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 注入数据库连接属性 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/test?serverTimeZone=UTC"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                (5)配置成功，测试即可</p>
<h2 id="二、Spring的事务控制"><a href="#二、Spring的事务控制" class="headerlink" title="二、Spring的事务控制"></a>二、Spring的事务控制</h2><p>​        在上一节的学习中，我们自己手动编写了事务管理器，并用配置aop的方式构建了新的切面，给业务层方法添加了事务管理。但是，在强大的Spring中，我们甚至不需要自己手写这些事务管理器，而可以使用Spring内置的事务管理器。我们要做的就是完成配置，即可实现事务控制。同样，Spring的事务控制可以通过xml与注解两种配置方式实现：</p>
<p>​        <strong>1.基于xml的事务控制</strong></p>
<p>​                （1） 配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                    (2)配置事务及其属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">read-only</span>=<span class="string">"false"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                    (3)配置AOP切面表达式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置AOP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置切面表达式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt1"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.service.Impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务的通知和切入点表达式的关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                    (4)配置事务通知和切入点表达式的关系</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置AOP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置切面表达式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt1"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.service.Impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务的通知和切入点表达式的关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​            <strong>2.基于注解的事务配置</strong></p>
<p>​                    (1)配置事务管理器（同上）</p>
<p>​                    (2)开启Spring对注解事务的支持</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启Spring对注解事务的支持 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​                    (3)在被增强方法的类上添加@Transactional注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED,readOnly = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                    (4)查询方法事务属性独特，可特定配置。(直接将注解加在方法前即可)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS,readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Account <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accountDao.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="三、Spring事务控制细节补充"><a href="#三、Spring事务控制细节补充" class="headerlink" title="三、Spring事务控制细节补充"></a>三、Spring事务控制细节补充</h2><p>​        <strong>1.事务属性</strong></p>
<p>​                Spring的自动事务控制，可以配置其相关属性，主要分为以下六点</p>
<blockquote>
<p>read-only：是否是只读事务。默认 false，不只读。</p>
<p>isolation：指定事务的隔离级别。默认值是使用数据库的默认隔离级别。</p>
<p>propagation：指定事务的传播行为。</p>
<blockquote>
<p>REQUIRED:如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。一般的选<br>择（默认值）<br>SUPPORTS:支持当前事务，如果当前没有事务，就以非事务方式执行（没有事务）</p>
</blockquote>
<p>timeout：指定超时时间。默认值为：-1。永不超时。 </p>
<p>rollback-for：用于指定一个异常，当执行产生该异常时，事务回滚。产生其他异常，事务不回滚。<br>没有默认值，任何异常都回滚。 </p>
<p>no-rollback-for：用于指定一个异常，当产生该异常时，事务不回滚，产生其他异常时，事务回 滚。没有默认值，任何异常都回滚。</p>
</blockquote>
<p>​        <strong>2.持久层支持</strong></p>
<p>​                笔者在学习初期，使用了dbutils实现持久层，但是在测试转账方法时，无法实现出现异常时的事务回滚,即事务配置失败。在改用jdbcTemplate之后，成功实现。</p>
<p>​                经验：Spring的自动事务控制需要配合jdbcTemplate，而不能使用dbutils。至于其他持久层实现如MyBatis能否成功配合Spring实现事务控制，作为小白的笔者尚不明确，盲猜一个“可以”。在日后的学习中，笔者一定会逐渐去接触Spring源码，有朝一日，定会以解决这个问题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/IDEA%E6%8A%A5%E9%94%99%EF%BC%9A%20class%20com.sun.proxy.$Proxy11%20cannot%20be%20cast%20to%20%E2%80%99XXXXX%E2%80%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/18/IDEA%E6%8A%A5%E9%94%99%EF%BC%9A%20class%20com.sun.proxy.$Proxy11%20cannot%20be%20cast%20to%20%E2%80%99XXXXX%E2%80%98/" class="post-title-link" itemprop="url">IDEA报错： class com.sun.proxy.$Proxy11 cannot be cast to ’XXXXX‘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-18 08:38:51 / 修改时间：08:40:33" itemprop="dateCreated datePublished" datetime="2020-02-18T08:38:51+08:00">2020-02-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="IDEA报错：-class-com-sun-proxy-Proxy11-cannot-be-cast-to-’XXXXX‘"><a href="#IDEA报错：-class-com-sun-proxy-Proxy11-cannot-be-cast-to-’XXXXX‘" class="headerlink" title="IDEA报错： class com.sun.proxy.$Proxy11 cannot be cast to ’XXXXX‘"></a>IDEA报错： class com.sun.proxy.$Proxy11 cannot be cast to ’XXXXX‘</h1><p>​        今天在学习Spring事务配置的过程中，发生了如上错误。原程序如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取ApplicationConext对象</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">        <span class="comment">//获取AccountServiceImpl对象</span></span><br><span class="line">        IAccountService as = (AccountServiceImpl) ac.getBean(<span class="string">"accountService"</span>);</span><br><span class="line">        <span class="comment">//执行方法</span></span><br><span class="line">        System.out.println(as.findById(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​        该测试类方法测试了根据id查找account对象的功能。在没有配置事务的时候，程序可以正常执行，但是在根据AOP配置了事务之后，出现了题示问题。</p>
<p>​        <strong>问题分析：</strong>由于Spring AOP的动态代理机制如下：对于没有实现任何接口的类，采用CGLIB方法；对于实现了接口的对象，默认使用JDK动态创建代理对象。而AccountServiceImpl实现了IAccountService接口，所以在获取bean对象并进行强制转换时，要转换成父类IAccountService。</p>
<p>​        <strong>解决方法：</strong>所以将上述代码中小括号中的AccountServiceImpl改成IAccountService即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取ApplicationConext对象</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">        <span class="comment">//获取AccountServiceImpl对象</span></span><br><span class="line">        IAccountService as = (IAccountService) ac.getBean(<span class="string">"accountService"</span>);</span><br><span class="line">        <span class="comment">//执行方法</span></span><br><span class="line">        System.out.println(as.findById(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/14/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/14/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">Spring学习笔记（三）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-14 19:53:06 / 修改时间：19:52:11" itemprop="dateCreated datePublished" datetime="2020-02-14T19:53:06+08:00">2020-02-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring学习笔记（三）"><a href="#Spring学习笔记（三）" class="headerlink" title="Spring学习笔记（三）"></a>Spring学习笔记（三）</h1><p>​        在前两个学习笔记中，我们掌握了Spring的第一个核心IOC，现在我们开始学习Spring的另一个核心，AOP</p>
<h2 id="一、AOP简介"><a href="#一、AOP简介" class="headerlink" title="一、AOP简介"></a>一、AOP简介</h2><p>​        1.<strong>概述：</strong></p>
<p>​                AOP为Aspect Oriented Programming的缩写，即面向切面编程。AOP是通过预编译方式和运行期间动态代理实现程序功能的统一维护的一种技术。</p>
<p>​                简单的说，AOP可以将我们重复的代码抽取出来，在需要执行时，采用动态代理的技术，在不修改源码的基础上，对原有方法进行增强</p>
<p>​        2.<strong>优势：</strong></p>
<p>​                减少重复代码</p>
<p>​                提高开发效率</p>
<p>​                方便维护</p>
<h2 id="二、AOP引入："><a href="#二、AOP引入：" class="headerlink" title="二、AOP引入："></a>二、AOP引入：</h2><p>​        1.<strong>问题抛出：</strong>        </p>
<p>​                在Spring学习笔记（二）中，我们实现了对Account对象的增删改查的持久层与业务层操作，并通过IOC配置，降低了程序的耦合。现我们增加一个transfer（即转账）操作，实现账户A向账户B的转账：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Integer giveAccountId, Integer recieveAccountId, Double money)</span></span>&#123;</span><br><span class="line">            <span class="comment">//1.获取转出账户</span></span><br><span class="line">            Account giveAccount = accountDao.findById(giveAccountId);</span><br><span class="line">            <span class="comment">//2.获取转入账户</span></span><br><span class="line">            Account recieveAccount = accountDao.findById(recieveAccountId);</span><br><span class="line">            <span class="comment">//3.转出账户减钱</span></span><br><span class="line">            giveAccount.setMoney(giveAccount.getMoney()-money);</span><br><span class="line">            <span class="comment">//4/转入账户价钱</span></span><br><span class="line">            recieveAccount.setMoney(recieveAccount.getMoney()+money);</span><br><span class="line">            <span class="comment">//5.更新转出账户</span></span><br><span class="line">            accountDao.update(giveAccount);</span><br><span class="line">            <span class="comment">//6.更新转入账户</span></span><br><span class="line">            accountDao.update(recieveAccount);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​                如此简单的实现，很容易出现不同步的问题：如果在<font size="2">第五步–更新转出账户</font>操作之后,程序出现了异常（例如在第五步后添加一句 int a = 1/0;)，那么第六步将不会成功执行，就会产生一个可怕的后果：转出账户的钱减少了，但是转入账户的前没有增加。</p>
<p>​        <strong>2.问题分析：</strong></p>
<p>​                为了解决这个问题我们需要加入事务控制，使得这些操作由一个连接来操作，而且使它们一起成功或者一起失败。</p>
<p>​                为此，我们编写了connectionUtils与TransactionManager类来进行事务控制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> ThreadLocal&lt;Connection&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDataSource</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getThreadConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//1.先从ThreadLocal上获取</span></span><br><span class="line">        Connection conn = tl.get();</span><br><span class="line">        <span class="comment">//2.判断当前线程上是否有连接</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(conn==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//3.从数据源中获取一个连接，并且存入ThreadLocal中</span></span><br><span class="line">                conn = dataSource.getConnection();</span><br><span class="line">                tl.set(conn);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4.返回当前线程上的连接</span></span><br><span class="line">            <span class="keyword">return</span> conn ;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把连接和线程解绑</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 和事务管理相关的工具类，它包含了，开启事务，提交事务，回滚事务和释放连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConnectionUtils connectionUtils ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectionUtils</span><span class="params">(ConnectionUtils connectionUtils)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionUtils = connectionUtils;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginTransaction</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connectionUtils.getThreadConnection().setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提交事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connectionUtils.getThreadConnection().commit();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回滚事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connectionUtils.getThreadConnection().rollback();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connectionUtils.getThreadConnection().close(); <span class="comment">//还回连接池中</span></span><br><span class="line">            connectionUtils.removeConnection();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                接下来就需要整合我们的转账操作与事务控制，使得能够保证转入与转出操作能够同步执行。这时候就会面临一个关键的问题：</p>
<p>​                <strong>如果直接将这些事务控制加到业务层接口实现类中，这会导致大量的代码重复，提升程序耦合性，而且需要修改源码。<font color="red">这样的作法是我们极不提倡的</font></strong></p>
<p>​                于是我们可以通过动态代理的方式，来解决上述问题。自己编写动态代理类，对于大神来说很轻松，但是对于小白来说，甚至会无从下手。而Spring技术可以通过AOP配置的方式，来帮我们自动实现动态代理，这就极大的方便了对原方法增强的操作。</p>
<h2 id="三、AOP细节"><a href="#三、AOP细节" class="headerlink" title="三、AOP细节"></a>三、AOP细节</h2><p>​        <strong>1.AOP相关术语</strong></p>
<p>​                （1）Joinpoint（连接点）：连接点是那些被拦截的点。在Spring中，这些点值的是被增强类的所有方法。</p>
<p>​                （2）Pointcut（切入点）：切入点是指我们要对哪些JoinPoint进行拦截的定义。即所有被增强的方法。<em>注意：所有切入点都是连接点，但连接点不一定是切入点。</em></p>
<p>​                （3）Target（目标对象）：被代理对象</p>
<p>​                （4）Proxy（代理）：一个类被织入增强后，产生的代理对象</p>
<p>​                （5）Weaving（织入）：把增强应用到目标对象来创建新的代理对象的过程。spring使用动态代理植入。</p>
<p>​                （6）Advice（通知/增强）：通知时拦截到连接点之后需要增加的代码。通知有五种类型：前置通知、后置通知、异常通知、最终通知、环绕通知</p>
<p>​                （7）Introduction（引介）：引介是一种特殊的通知，在不修改类代码的前提下，Introduction可以在运行期为类动态地添加一些方法或Field。</p>
<p>​                （8）Aspect（切面）：切入点与通知的结合</p>
<p>​        <strong>2.代理的选择</strong></p>
<p>​                在Spring中，框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式</p>
<h2 id="四、基于XML的AOP配置"><a href="#四、基于XML的AOP配置" class="headerlink" title="四、基于XML的AOP配置"></a>四、基于XML的AOP配置</h2><p>​        <strong>1.导入jar包：</strong></p>
<p>​                mysql、spring-framework、spring-test、commons-dbutils、c3p0、junit，aspectjweaver</p>
<p>​        <strong>2.在bean.xml文件中导入约束</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​        <strong>3.配置通知bean对象:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"TxManager"</span> <span class="attr">class</span>=<span class="string">"com.itheima.utils.TransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入connectionUtils--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionUtils"</span> <span class="attr">ref</span>=<span class="string">"connectionUtils"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>4.配置切面：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置AOP--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"TxManager"</span> <span class="attr">ref</span>=<span class="string">"TxManager"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt1"</span> <span class="attr">expression</span>=<span class="string">"execution(* *..AccountServiceImpl.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"beginTransaction"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"commit"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"rollback"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"release"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                &#60;aop:config&#62;标签用于标识开始AOP配置</p>
<p>​                &#60;aop:aspect&#62;标签用于标识开始AOP切面配置</p>
<p>​                &#60;aop:pointcut&#62;标签用于配置切入点表达式，id属性指定该切入点表达式的标识符，expression指定被配置的切入点表达式</p>
<p>​                &#60;aop:before&#62;标签用于配置前置通知，method属性指定作为前置通知的方法，pointcut-ref属性中填写切入点表达式，指定被增强的方法</p>
<p>​                &lt;aop:after-returning&#62;标签用于配置后置通知，作用同上</p>
<p>​                &lt;aop:after-throwing&#62;标签用于配置异常通知，作用同上</p>
<p>​                &lt;aop:after&#62;标签用于配置最终通知，作用同上</p>
<p>​        <strong>5.配置完成，测试结果</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 测试转账操作</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransfer</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">//执行转账操作</span></span><br><span class="line">       as.transfer(<span class="number">2</span>,<span class="number">1</span>,<span class="number">450.0</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>​                该测试类调用转账操作，我们在更新转出账户之后添加了异常语句（int a =1/0;），执行。</p>
<p>​                执行结果失败，但是事务回滚成功，转出账户的money没有减少。成功！</p>
<h2 id="五、基于注解的AOP配置"><a href="#五、基于注解的AOP配置" class="headerlink" title="五、基于注解的AOP配置"></a>五、基于注解的AOP配置</h2><p>​        <strong>1.导入jar包</strong></p>
<p>​                同4.1</p>
<p>​        <strong>2.在bean.xml中导入约束</strong></p>
<p>​                同4.2</p>
<p>​        <strong>3.在通知类上添加@Aspect注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManager</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        <strong>4.在相应的通知前加上相应的注解</strong>(@Before @AfterReturning@AfterThrowing@After)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(* *..AccountServiceImpl(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginTransaction</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connectionUtils.getThreadConnection().setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​            注解的小括号中写好切入点表达式</p>
<p>​        <strong>5.在Sprig配置文件中开启Spring对注解AOP的支持（一句配置即可）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="六、环绕通知的配置"><a href="#六、环绕通知的配置" class="headerlink" title="六、环绕通知的配置"></a>六、环绕通知的配置</h2><p>​        环绕通知是一种很特殊的通知，通过配置环绕通知甚至可以实现所有其他四种通知的配置。</p>
<p>​        <strong>1.bean.xml中配置环绕通知</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.service.impl.*.*(..))"</span><span class="attr">id</span>=<span class="string">"pt1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">ref</span>=<span class="string">"txManager"</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 配置环绕通知 --&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"transactionAround"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>2.编写transactionAround方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * 环绕通知 </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pjp </span></span><br><span class="line"><span class="comment">* spring 框架为我们提供了一个接口：ProceedingJoinPoint，它可以作为环绕通知的方法参数。</span></span><br><span class="line"><span class="comment">* 在环绕通知执行时，spring 框架会为我们提供该接口的实现类对象，我们直接使用就行。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transactionAround</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义返回值</span></span><br><span class="line">    Object rtValue = <span class="keyword">null</span>; <span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//获取方法执行所需的参数</span></span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">    	<span class="comment">//前置通知：开启事务</span></span><br><span class="line">        beginTransaction();</span><br><span class="line">    	<span class="comment">//执行方法 </span></span><br><span class="line">        rtValue = pjp.proceed(args);</span><br><span class="line">    	<span class="comment">//后置通知：提交事务</span></span><br><span class="line">        commit();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">    	<span class="comment">//异常通知：回滚事务</span></span><br><span class="line">    	rollback();</span><br><span class="line">    	e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    	<span class="comment">//最终通知：释放资源 </span></span><br><span class="line">    	release();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rtValue; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​        若是采用注解配置的方式，则整合以上两步，在transactionAround方法上添加注解@Around即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * 环绕通知 </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pjp </span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Around</span>(<span class="string">"execution(* com.itheima.service.impl.*.*(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transactionAround</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义返回值</span></span><br><span class="line">    Object rtValue = <span class="keyword">null</span>; <span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//获取方法执行所需的参数</span></span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">    	<span class="comment">//前置通知：开启事务</span></span><br><span class="line">        beginTransaction();</span><br><span class="line">    	<span class="comment">//执行方法 </span></span><br><span class="line">        rtValue = pjp.proceed(args);</span><br><span class="line">    	<span class="comment">//后置通知：提交事务</span></span><br><span class="line">        commit();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">    	<span class="comment">//异常通知：回滚事务</span></span><br><span class="line">    	rollback();</span><br><span class="line">    	e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    	<span class="comment">//最终通知：释放资源 </span></span><br><span class="line">    	release();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rtValue; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/11/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/11/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">Spring学习笔记（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-11 12:38:32 / 修改时间：12:37:56" itemprop="dateCreated datePublished" datetime="2020-02-11T12:38:32+08:00">2020-02-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring学习笔记（二）"><a href="#Spring学习笔记（二）" class="headerlink" title="Spring学习笔记（二）"></a>Spring学习笔记（二）</h1><p>​        今日学习的主要内容，是基于注解的IOC配置以及Spring整合JUnit的测试操作。注解开发分为两个部分：</p>
<p>常用注解与新注解。常用注解主要用于配置自己编写的类，而新注解用于配置引用的无法修改的类。常用注解的使用可以明显地简化开发，但新注解常常使步骤更加繁琐。所以，我们在开发中应保持一下原则：自己编写的类使用常用注解，引用的类采用xml配置。</p>
<p>​        </p>
<p>​        在讲解常用注解之前，首先要注意环境配置。</p>
<p>​        在xml配置的基础上，只需要1)更改约束，2)添加一句xml语句指定创建IOC容器要扫描的包即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.itheima"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="一、常用注解"><a href="#一、常用注解" class="headerlink" title="一、常用注解"></a>一、常用注解</h2><p>​        Spring的常用注解分为四类：用于创建对象的（4），用于注入数据的（4），用于控制作用范围的（1），与生命周期相关的（2）。</p>
<h4 id="1、用于创建对象的"><a href="#1、用于创建对象的" class="headerlink" title="1、用于创建对象的"></a>1、用于创建对象的</h4><p>​                <font color="red">相当于<bean id class> </bean></font></p>
<p>​                1） @Component：</p>
<p>​                        <strong>作用：</strong>把对象交给Spring来管理，相当于在xml中配bean</p>
<p>​                        <strong>位置：</strong>在对象类的上方</p>
<p>​                        <strong>属性：</strong>value属性：指定bean的id。若不指定value，则bean的默认id是当前类的类名（首字母小写）</p>
<p>​                        <strong>示例：</strong>在本例中，备注解的类AccountDaoImpl，在IOC容器中被创建，且id为accountDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span>(<span class="string">"accountDao"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                2）@Controller @Service @Repository</p>
<p>​                        这三个注解的作用、位置、属性与@Component完全相同，只不过@Controller常用在控制层类前，@Service常用在业务层类前，@Repository常用在持久层类前</p>
<h4 id="2、用于注入数据的"><a href="#2、用于注入数据的" class="headerlink" title="2、用于注入数据的"></a>2、用于注入数据的</h4><p>​                <font color="red">相当于<property name ref>或<property name value></property></property></font></p>
<p>​                1） @Autowired</p>
<p>​                        <strong>作用:</strong>自动按照类型注入。当使用注解注入属性时，set方法可以省略。它只能注入其他bean类型。当IOC容器中有多个bean类型与之匹配时，使用要注入的对象变量名称作为bean的id，在Spring容器中查找key，找到相同也可成功注入。找不到则报错</p>
<p>​                        <strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDaoImpl accountDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​                2）@Qualifier</p>
<p>​                        <strong>作用：</strong>在自动按照类型的基础上，在按照Bean的id注入。它在给字段注入时不能独立使用，必须和@Autowired一起使用；但是给方法参数注入时，可以单独使用。</p>
<p>​                    <em>（相当于Autowired是狙击枪，Qualifier是瞄准镜，可以根据id更好地定位，以解决IOC容器中有多个bean类型与被注解bena对象类型匹配的问题）</em></p>
<p>​                        <strong>属性：</strong>value：指定bean的id</p>
<p>​                        <strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"accountDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> AccountDaoImpl accountDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                3)@Resource</p>
<p>​                        <strong>作用：</strong>直接按照Bean的id注入。相当于Autowired与Qualified的整合，也只能注入bean对象</p>
<p>​                        <strong>属性：</strong>name：指定bean的id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"accountDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> AccountDaoImpl accountDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​                4)@Value</p>
<p>​                        <strong>作用：</strong>注入基本类型的数据和String类型的数据</p>
<p>​                        <strong>属性：</strong>value：用于指定值</p>
<p>​                        <strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(value=<span class="string">"12.0"</span>)</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"xioawang"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、用于改变作用范围的"><a href="#3、用于改变作用范围的" class="headerlink" title="3、用于改变作用范围的"></a>3、用于改变作用范围的</h4><p>​                <font color="red">相当于<bean id scope></bean></font></p>
<p>​                1）@Scope</p>
<p>​                            <strong>作用：</strong>指定bean的作用范围</p>
<p>​                            <strong>属性：</strong>value：指定范围的值：</p>
<p>​                                                取值：singleton protoType  request session globalsession</p>
<h4 id="4、与生命周期相关的（了解）"><a href="#4、与生命周期相关的（了解）" class="headerlink" title="4、与生命周期相关的（了解）"></a>4、与生命周期相关的（了解）</h4><p>​                <font color="red">相当于<bean id class init-method destroy-method></bean></font></p>
<p>​                1）@PostConstruct</p>
<p>​                        <strong>作用：</strong>用于定义初始化方法</p>
<p>​                2）@PreDestroy</p>
<p>​                        <strong>作用：</strong> 用于指定销毁方法</p>
<h2 id="二、新注解"><a href="#二、新注解" class="headerlink" title="二、新注解"></a>二、新注解</h2><p>​        1.@Component</p>
<p>​                <strong>作用：</strong>用于指定当前类是一个Spring配置类，当创建容器时会从该类上加载注解。获取容器时需要使用AnnotationApplicationContext（有@Component注解的类.class)</p>
<p>​                <strong>属性：</strong>value：用于指定配置类的字节码</p>
<p>​                <strong>示例：</strong>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        2.@ComponentScan</p>
<p>​                    <strong>作用：</strong>用于指定Spring在创建初始化IOC容器时要扫描的包。作用和在xml配置中的：</p>
<p>&lt;context:component-scan base-package=”com.itheima”/&gt;是一样的</p>
<p>​                    <strong>属性：</strong>backPackages/value:用于指定要扫描的包。</p>
<p>​                    <strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.itheima"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​            3.@Bean</p>
<p>​                        <strong>作用：</strong>该注解只能卸方法上，表明使用此方法创建一个对象，并存入Spring容器。</p>
<p>​                        <strong>属性：</strong>name：给当前@Bean注解方法创建的对象指定一个名称（即bean的id）</p>
<p>​                        <strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line">	<span class="comment">/** * 创建一个数据源，并存入 spring 容器中 * <span class="doctag">@return</span> */</span></span><br><span class="line">	<span class="meta">@Bean</span>(name=<span class="string">"dataSource"</span>) </span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">			ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource(); 		</span><br><span class="line">            ds.setUser(<span class="string">"root"</span>); ds.setPassword(<span class="string">"1234"</span>); </span><br><span class="line">            ds.setDriverClass(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">            ds.setJdbcUrl(<span class="string">"jdbc:mysql:///spring_day02"</span>); <span class="keyword">return</span> ds;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">/** * 创建一个 DBAssit，并且也存入 spring 容器中 * <span class="doctag">@param</span> dataSource * <span class="doctag">@return</span> */</span></span><br><span class="line">	<span class="meta">@Bean</span>(name=<span class="string">"dbAssit"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> DBAssit <span class="title">createDBAssit</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DBAssit(dataSourc e);	</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                    4.@Import</p>
<p>​                            <strong>作用:</strong> 用于在主配置文件中，引入从配置文件。从配置文件可以不写@Configuration注解，但是写了也不报错。</p>
<p>​                            <strong>属性：</strong>value[]：用于指定其他配置类的字节码</p>
<p>​                            <strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.itheima.spring"</span>) </span><br><span class="line"><span class="meta">@Import</span>(&#123; JdbcConfig<span class="class">.<span class="keyword">class</span>&#125;) </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SpringConfiguration</span> </span>&#123; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​                    5.@PropertySource</p>
<p>​                            <strong>作用：</strong>用于加载properties文件中的配置。例如我们配置数据源时，可以把数据库的连接信息写在properties配置文件中，就可以使用此注解指定properties配置文件的位置。</p>
<p>​                            <strong>属性：</strong>value[]:用于指定properties文件位置。如果是类路径下，需要写上<font color="blue">classPath:</font></p>
<p>​                            <strong>示例：</strong></p>
<p>有一个jdbConfig.properties文件,指定了数据库连接的信息：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span> = <span class="string">jdbc:mysql://localhost:3306/test?serverTimeZone=UTC</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>

<p>且有一个数据库信息配置类通过自动注入的方式注入这些信息；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">jdbcConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driver ;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url ;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username ;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但要想java类能够找到这些信息，必须有一个注解来告诉它，去哪儿可以找到这些el表达式指定的值。</p>
<p>即用propertySource注解来指定properties文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.itheima"</span>)</span><br><span class="line"><span class="meta">@Import</span>(jdbcConfig<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@PropertySource("jdbc.properties")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、Spring与Junit的整合"><a href="#三、Spring与Junit的整合" class="headerlink" title="三、Spring与Junit的整合"></a>三、Spring与Junit的整合</h2><p>​        <strong>问题</strong></p>
<p>​                在测试类中，每个测试方法都有以下两行代码： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line"></span><br><span class="line">IAccountService as = ac.getBean(<span class="string">"accountService"</span>,IAccountService<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>​                这两行代码的作用是获取容器，如果不写的话，直接会提示空指针异常。所以又不能轻易删掉。</p>
<p>​        <strong>解决方法</strong></p>
<p>​                但是通过Spring框架与JUnit的整合，它可以提供一个运行器，可以读取配置文件（或注解）来创建容器，我们只需要告诉它配置文件在哪儿即可。</p>
<p>​        <strong>配置步骤：</strong></p>
<p>​                1.拷贝整个JUnit的必备jar包到lib目录。（IDEA编写pom.xml可自动导包）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                2.使用@RunWith注解替换原有运行器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>) </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                3.使用@ContextConfiguration指定Spring配置文件的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>) </span></span><br><span class="line"><span class="class">@<span class="title">ContextConfiguration</span>(<span class="title">locations</span></span>= &#123;<span class="string">"classpath:bean.xml"</span>&#125;) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                4.使用@Autowired给测试类的变量注入数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ContextConfiguration</span>(<span class="title">locations</span></span>= &#123;<span class="string">"classpath:bean.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span> <span class="keyword">private</span> IAccountService as ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/09/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/09/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">Spring学习笔记（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-09 10:31:07 / 修改时间：10:30:27" itemprop="dateCreated datePublished" datetime="2020-02-09T10:31:07+08:00">2020-02-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring学习笔记（一）"><a href="#Spring学习笔记（一）" class="headerlink" title="Spring学习笔记（一）"></a>Spring学习笔记（一）</h1><p>​        MyBatis的学习已经告一段落了，持久层往上就到了服务层。服务层的技术便是我们顶顶大名的spring。</p>
<h2 id="一、Spring概述"><a href="#一、Spring概述" class="headerlink" title="一、Spring概述"></a>一、Spring概述</h2><p>​        Spring是一款javaEE轻量级开源框架，以IOC（反转控制）和AOP（面向切面编程）为内核，提供了SpringMVC和持久层Spring JDBC以及业务层事务管理等众多的企业级应用技术，还能整合开源世界众多著名的第三方框架，和类库，逐渐成为使用最多的JavaEE企业应用开源框架。</p>
<h2 id="二、Spring的优势"><a href="#二、Spring的优势" class="headerlink" title="二、Spring的优势"></a>二、Spring的优势</h2><p>​        <strong>1.方便解耦，简化开发</strong></p>
<p>​        <strong>2.AOP编程的支持</strong></p>
<p>​        <strong>3.声明式事务的支持</strong></p>
<p>​        <strong>4.方便程序的测试</strong></p>
<p>​        <strong>5.方便集成各种优秀框架</strong></p>
<p>​        <strong>6.降低JavaEE的使用难度</strong></p>
<p>​        <strong>7.Spring源码是经典的学习案例</strong></p>
<h2 id="三、程序耦合"><a href="#三、程序耦合" class="headerlink" title="三、程序耦合"></a>三、程序耦合</h2><p>​        在讲解Spring的一大核心IOC之前，我们首先要弄明白什么是程序的耦合。</p>
<p>​        在这里引入一小段耦合的概念，看不懂一笑而过即可。</p>
<blockquote>
<p>在软件工程中，耦合指的就是就是对象之间的依赖性。对象之间的耦合越高，维护成本越高。因此对象的设计 应使类和构件之间的耦合最小。软件设计中通常用耦合度和内聚度作为衡量模块独立程度的标准。划分模块的一个 准则就是高内聚低耦合。</p>
</blockquote>
<p>​        <strong>用通俗的话来说，耦合就是程序尤其是对象之间的关联程度。关联程度越高，我们修改代码时，需要修改的地方就越多。这样既会导致维护成本提高，也会致使出错的概率提升。所以我们要尽量减少程序间的关联程度，即耦合度。</strong></p>
<p>​    耦合有以下分类：</p>
<blockquote>
<p>1） 内容耦合。当一个模块直接修改或操作另一个模块的数据时，或一个模块不通过正常入口而转入另 一个模块时，这样的耦合被称为内容耦合。内容耦合是最高程度的耦合，应该避免使用之。 </p>
<p>2） 公共耦合。两个或两个以上的模块共同引用一个全局数据项，这种耦合被称为公共耦合。在具有大 量公共耦合的结构中，确定究竟是哪个模块给全局变量赋了一个特定的值是十分困难的。 </p>
<p>3） 外部耦合 。一组模块都访问同一全局简单变量而不是同一全局数据结构，而且不是通过参数表传<br>递该全局变量的信息，则称之为外部耦合。 </p>
<p>4） 控制耦合 。一个模块通过接口向另一个模块传递一个控制信号，接受信号的模块根据信号值而进 行适当的动作，这种耦合被称为控制耦合。 </p>
<p>5） 标记耦合 。若一个模块 A 通过接口向两个模块 B 和 C 传递一个公共参数，那么称模块 B 和 C 之间<br>存在一个标记耦合。 </p>
<p>6） 数据耦合。模块之间通过参数来传递数据，那么被称为数据耦合。数据耦合是最低的一种耦合形<br>式，系统中一般都存在这种类型的耦合，因为为了完成一些有意义的功能，往往需要将某些模块的输出数据作为另 一些模块的输入数据。 </p>
<p>7） 非直接耦合 。两个模块之间没有直接关系，它们之间的联系完全是通过主模块的控制和调用来实<br>现的。</p>
</blockquote>
<p>​    </p>
<p>​        <strong>总结：耦合是影响软件复杂程度和设计质量的一个重要因素，在编写程序的过程中，我们应采取一下原则：如果模块间必须存在耦合，那么尽量使用数据耦合，少用控制耦合，限制公共耦合的范围，尽量避免内容耦合</strong></p>
<h2 id="四、程序解耦举例"><a href="#四、程序解耦举例" class="headerlink" title="四、程序解耦举例"></a>四、程序解耦举例</h2><p>​        我们可以将解耦理解成一句话，即：<strong>做到程序编译器不报错，运行期才报错</strong></p>
<p>​        以JDBC基本操作为例，我们在注册驱动时可以采用以下的写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DriverManager.registerDriver(<span class="keyword">new</span> com.mysql.jdbc.Driver());</span><br></pre></td></tr></table></figure>

<p>​        由于我们采用了new关键字，一旦我们将mysql驱动的jar包删除，这条语句将在编译器就会报错，这体现出JDBC与Driver类的耦合度过高。</p>
<p>​        要想降低两者之间的耦合度，可以用反射的机制来注册驱动：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);<span class="comment">//此处只是一个字符串</span></span><br></pre></td></tr></table></figure>

<p>​        采用这种写法，即使删除jar包，编译器也不会报错，这便实现了解耦。（当然程序是无法运行的，在运行期必然会报错。）</p>
<p>​        <strong>实际上一种更常见的解耦方式就是采用工厂模式来实现控制反转（IOC）</strong></p>
<h2 id="五、IOC–控制反转"><a href="#五、IOC–控制反转" class="headerlink" title="五、IOC–控制反转"></a>五、IOC–控制反转</h2><p>​        概念：</p>
<blockquote>
<p>控制反转把创建对象的权利交给框架，是框架的重要特征，并非面向对象编程的专用术语。它包括依赖注入和依赖查找</p>
</blockquote>
<p>​        作用：</p>
<blockquote>
<p>削减计算机·程序的耦合，降低程序间的以来关系</p>
</blockquote>
<p>​        分析：</p>
<p>​                原来我们获取对象时，采用new的方式，是主动去找</p>
<p>​                现在我们获取对象时，是由工厂创建或查找得到的，是被动获得。</p>
<p>​                这种控制权交给工厂的形式就叫做控制反转（IOC）</p>
<h2 id="六、Spring中的IOC"><a href="#六、Spring中的IOC" class="headerlink" title="六、Spring中的IOC"></a>六、Spring中的IOC</h2><p>​        Spring框架一大精妙之处就在于，能够帮助实现控制反转，通过配置bean对象，spring可以自动生成该对象的工厂，并且提供服务。这不仅有利于降低程序间的耦合，还大大提高了开发效率。</p>
<p>​        <strong>入门案例：</strong></p>
<p>​            通过spring中xml配bean的方式，实现dao与service对象的创建：</p>
<p>​        <strong>1.导入spring依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>2.编写service与dao层的接口与实现类（省略）</strong>            </p>
<p>​        <strong>3.配置bean.xml文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 把对象的创建交给spring来管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.Impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.itheima.dao.Impl.AccountDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>4.创建使用bean对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//获取核心容器对象</span></span><br><span class="line">       ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">       <span class="comment">//根据id获取bean对象</span></span><br><span class="line">       IAccountService as = (IAccountService) ac.getBean(<span class="string">"accountService"</span>);</span><br><span class="line">       IAccountDao adao = ac.getBean(<span class="string">"accountDao"</span>,IAccountDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">       System.out.println(as);</span><br><span class="line">       System.out.println(adao);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>​        <strong>5.（成功）测试打印结果</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.itheima.service.Impl.AccountServiceImpl@<span class="number">5</span>ea434c8</span><br><span class="line">com.itheima.dao.Impl.AccountDaoImpl@<span class="number">3</span>bbc39f8</span><br></pre></td></tr></table></figure>





<p>​        <em>值得注意的·是，根据id获取bean对象时，有两种方式进行类型转换：</em></p>
<p>​        <em>1.强制类型转换</em></p>
<p>​        <em>2.传入转后类型的字节码作为参数</em></p>
<h2 id="六、SpringIOC的细节与bean标签"><a href="#六、SpringIOC的细节与bean标签" class="headerlink" title="六、SpringIOC的细节与bean标签"></a>六、SpringIOC的细节与bean标签</h2><p>​        <strong>1.beanFactory与ApplicationContext的联系与区别：</strong></p>
<p>​                BeanFactory是Spring的顶层接口，ApplicationContext是BeanFactroy的底层接口</p>
<p>​                ApplicationContext接口的实现类：</p>
<p>​                        （1）ClassPathXmlApplicationContext:</p>
<p>​                                    从类的根路径下加载配置文件 （推荐使用）</p>
<p>​                        （2）FileSystemXmlApplicationContext：</p>
<p>​                                    从磁盘的路径下加载配置文件，配置文件可以在磁盘的任意位置</p>
<p>​                        （3）AnnotationConfigApplicationContext：</p>
<p>​                                    使用注解配置容器对象时，需要此类来创建spring容器。它用来读取注解</p>
<p>​            BeanFactroy与ApplicationConext的创建对象的时间不同：</p>
<p>​                         （1）BeanFactory只有当对象被使用的时候，才会创建对象（延迟加载）</p>
<p>​                        （2） ApplicationConext只要加载配置文件，就会创建对象（立即加载）</p>
<p>​        <strong>2.bean标签</strong></p>
<p>​                <strong>作用：</strong></p>
<p>​                        用于配置对象，以便Spring创建。</p>
<p>​                        <em>默认情况下它调用对象类中的无参构造函数。如果没有无参构造函数则创建失败</em></p>
<p>​                <strong>属性：</strong></p>
<p>​                        （1）id：给对象在容器中提供唯一标识。用于获取对象</p>
<p>​                        （2）class：指定类的全限定类名。用于反射创建对象。默认情况下调用无参构造函数</p>
<p>​                        （3）scope：指定对象的作为范围：</p>
<p>​                                            a) <font color="red">singleton:  默认值，单例的</font></p>
<p>​                                            b) <font color="red">prototype: 多例的</font>    </p>
<p>​                                            c) request:  WEB项目中，Spring创建一个Bean对象，将对象存到request域中</p>
<p>​                                            d）session：在WEB项目中，Spring创建一个Bean对象，将对象存到session域中</p>
<p>​                                            e）globalSession：WEB项目中，运行在Portlet环境中，如果没有Protlet环境，                                                   globalSession相当于session</p>
<p>​                          (4)  init-method:指定类中的初始化方法名称</p>
<p>​                          (5)  destroy-method:指定类中的销毁方法名称</p>
<p>​                    <strong>bean对象的作用范围与生命周期：</strong></p>
<p>​                        <font color="red">    单例对象：scope=”singleton”:</font></p>
<p>​                                    一个应用只有一个对象的实例。作用范围即整个应用</p>
<p>​                                    生命周期：</p>
<p>​                                                对象出生：当应用加载，创建容器时，对象就被创建了</p>
<p>​                                                对象活着：只要容器在，对象一直活着</p>
<p>​                                                对象死亡：当应用卸载，销毁容器时，对象就被销毁了</p>
<p>​                        <font color="red">    多例对象：scope=”protoType”:</font>    </p>
<p>​                                    每次对象访问的时候，都会重新创建对象实例</p>
<p>​                                    生命周期：</p>
<p>​                                                对象出生：当使用对象时，新的对象被创建</p>
<p>​                                                对象活着：只要对象在使用中，就一直活着</p>
<p>​                                                对象死亡：当对象长时间不用时，被java垃圾回收器回收了</p>
<p>​                    <strong>实例化bean对象的三种方式：</strong></p>
<p>​                            （1）使用默认无参构造函数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在默认情况下：</span></span><br><span class="line"><span class="comment">它会根据默认无参构造函数来创建类对象。如果 bean 中没有默认无参构造函数，将会创建失败。--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.AccountServiceImpl"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                              (2)spring管理工厂–使用实例工厂的方法创建对象(当我们要创建jar包中的类时，这个类又没有无参构造函数，常常使用这种方式)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 此种方式是：</span></span><br><span class="line"><span class="comment">先把工厂的创建交给 spring 来管理。</span></span><br><span class="line"><span class="comment">然后在使用工厂的 bean 来调用里面的方法 </span></span><br><span class="line"><span class="comment">factory-bean 属性：用于指定实例工厂 bean 的 id。</span></span><br><span class="line"><span class="comment">factory-method 属性：用于指定实例工厂中创建对象的方法。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"instancFactory"</span> <span class="attr">class</span>=<span class="string">"com.itheima.factory.InstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-bean</span>=<span class="string">"instancFactory"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">"createAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<pre><code>(3)  spring静态管理工厂--使用静态工厂的方法创建对象:  </code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 此种方式是:</span></span><br><span class="line"><span class="comment"> 	使用 StaticFactory 类中的静态方法 createAccountService 创建对象，并存入 spring 容器 </span></span><br><span class="line"><span class="comment">	id 属性：指定 bean 的 id，用于从容器中获取 </span></span><br><span class="line"><span class="comment">	class 属性：指定静态工厂的全限定类名</span></span><br><span class="line"><span class="comment">	factory-method 属性：指定生产对象的静态方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"com.itheima.factory.StaticFactory"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">"createAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="七、Spring的依赖注入"><a href="#七、Spring的依赖注入" class="headerlink" title="七、Spring的依赖注入"></a>七、Spring的依赖注入</h2><p>​        <strong>依赖注入：Dependency Injection。它是Spring框架核心IOC的具体体现</strong></p>
<p>​        我们在程序编写时，通过控制反转，把对象的创建交给了Spring，但是代码中不可能出现没有依赖的情况。IOC解耦只是降低耦合度，但不会消除耦合。例如我们的业务层仍会调用持久层的方法。</p>
<p>​        那这种业务层和持久层的依赖关系，在使用Spring之后，就让Spring去维护了/</p>
<p>​        简答的说，就是坐等框架把持久层对象传入业务层，而不用我们自己去获取。</p>
<p>​        <strong>Spring依赖注入的三种规范方式：</strong></p>
<p>​            <strong>（1）构造函数注入：</strong></p>
<p>​            顾名思义，即通过调用使用类中的构造函数，给成员变量赋值。</p>
<p>​            例如某个AccountService类如下：      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AccountServiceImpl</span><span class="params">(String name, Integer age, Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name; <span class="keyword">this</span>.age = age; <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​            注入方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用构造函数的方式，给 service 中的属性传值 </span></span><br><span class="line"><span class="comment">	要求：</span></span><br><span class="line"><span class="comment">		类中需要提供一个对应参数列表的构造函数。</span></span><br><span class="line"><span class="comment">	涉及的标签：</span></span><br><span class="line"><span class="comment"> 		constructor-arg </span></span><br><span class="line"><span class="comment">			属性：</span></span><br><span class="line"><span class="comment">				index:指定参数在构造函数参数列表的索引位置</span></span><br><span class="line"><span class="comment"> 				type:指定参数在构造函数中的数据类型</span></span><br><span class="line"><span class="comment">				name:指定参数在构造函数中的名称   用这个找给谁赋值 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">				=======上面三个都是找给谁赋值，下面两个指的是赋什么值的==============</span></span><br><span class="line"><span class="comment">				value:它能赋的值是基本数据类型和 String 类型</span></span><br><span class="line"><span class="comment"> 				ref:它能赋的值是其他 bean 类型，也就是说，必须得是在配置文件中配置过的 bean</span></span><br><span class="line"><span class="comment">--&gt;</span>	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.Impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"张三"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"birthday"</span> <span class="attr">ref</span>=<span class="string">"now"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"now"</span> <span class="attr">class</span>=<span class="string">"java.util.Data"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>(2)set方法注入：</strong></p>
<p>​                顾名思义，就是在类中提供需要注入成员的set方法。</p>
<p>​                例如某个AccountService类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123; </span><br><span class="line">    	<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                注入方式如下；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过配置文件给 bean 中的属性传值：</span></span><br><span class="line"><span class="comment">	使用 set 方法的方式 涉及的标签： </span></span><br><span class="line"><span class="comment">		property</span></span><br><span class="line"><span class="comment">			属性：</span></span><br><span class="line"><span class="comment">				name：找的是类中 set 方法后面的部分</span></span><br><span class="line"><span class="comment"> 				ref：给属性赋值是其他 bean 类型的</span></span><br><span class="line"><span class="comment"> 				value：给属性赋值是基本数据类型和 string 类型的</span></span><br><span class="line"><span class="comment">		实际开发中，此种方式用的较多。</span></span><br><span class="line"><span class="comment">--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.AccountServiceImpl"</span>&gt;</span> 			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"21"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"birthday"</span> <span class="attr">ref</span>=<span class="string">"now"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"now"</span> <span class="attr">class</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​    <strong>（3）使用p名称空间注入数据（本质还是调用set方法）</strong>    </p>
<p>​            此种方式是通过在xml种导入p名称空间，使用p：propertyName来注入数据，它的本质仍是调用类中的set方法实现注入功能。</p>
<p>​            AccountService类同上</p>
<p>​            注入方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">" http://www.springframework.org/schema/beans 						http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.AccountServiceImpl4"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:name</span>=<span class="string">"test"</span> <span class="attr">p:age</span>=<span class="string">"21"</span> <span class="attr">p:birthday-ref</span>=<span class="string">"now"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>(4)注入集合属性</strong></p>
<p>​                顾名思义，就是给类种的集合成员传值，它用的也是set方法注入的方式，只不过变量的数据类型都是集合。我们这里介绍注入数组，List，Set，Map，Properties。</p>
<p>​            例如某AccountService类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String[] myStrs;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; myList;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; mySet;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; myMap;</span><br><span class="line">    <span class="keyword">private</span> Properties myProps;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyStrs</span><span class="params">(String[] myStrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myStrs = myStrs;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyList</span><span class="params">(List&lt;String&gt; myList)</span> </span>&#123; </span><br><span class="line">    	<span class="keyword">this</span>.myList = myList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMySet</span><span class="params">(Set&lt;String&gt; mySet)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.mySet = mySet;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyMap</span><span class="params">(Map&lt;String, String&gt; myMap)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.myMap = myMap;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyProps</span><span class="params">(Properties myProps)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.myProps = myProps;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​            注入方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">!-- 注入集合数据 </span><br><span class="line">	List 结构的：</span><br><span class="line">		array,list,set </span><br><span class="line">	Map 结构的</span><br><span class="line">		map,entry,props,prop</span><br><span class="line">--&gt; </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.AccountServiceImpl"</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 在注入集合数据时，只要结构相同，标签可以互换 --&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 给数组注入数据 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myStrs"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 注入 list 集合数据 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myList"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 注入 set 集合数据 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mySet"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入 Map 数据 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myMap"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"testA"</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">prop</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"testB"</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 注入 properties 数据 --&gt;</span></span><br><span class="line">    property name="myProps"&gt; </span><br><span class="line">    	<span class="tag">&lt;<span class="name">map</span>&gt;</span> </span><br><span class="line">            <span class="comment">&lt;!-- 方式1 --&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"testA"</span> <span class="attr">value</span>=<span class="string">"aaa"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span> </span><br><span class="line">        	<span class="comment">&lt;!-- 方式2 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"testB"</span>&gt;</span> </span><br><span class="line">            	<span class="tag">&lt;<span class="name">value</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/05/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/05/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/" class="post-title-link" itemprop="url">MyBatis学习笔记（四）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-05 08:59:24" itemprop="dateCreated datePublished" datetime="2020-02-05T08:59:24+08:00">2020-02-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-04 16:45:08" itemprop="dateModified" datetime="2020-02-04T16:45:08+08:00">2020-02-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatis学习笔记（四）"><a href="#MyBatis学习笔记（四）" class="headerlink" title="MyBatis学习笔记（四）"></a>MyBatis学习笔记（四）</h1><h2 id="一、MyBatis的延迟加载"><a href="#一、MyBatis的延迟加载" class="headerlink" title="一、MyBatis的延迟加载"></a>一、MyBatis的延迟加载</h2><p>​        <strong>问题：</strong></p>
<p>​                在一对多中，我们有一个用户，它有100个账户，</p>
<p>​                在查询用户时，要不要吧关联的账户查出来？</p>
<p>​                在查询账户是，要不要把关联的用户查出来？</p>
<p>​        <strong>答案：</strong></p>
<p>​                在查询用户时，用户下的账户信息应随用随查（延迟加载）</p>
<p>​                在查询账户时，账户的所属用户应立即查出来（立即加载）</p>
<p>​        <strong>延迟加载：</strong></p>
<p>​                在使用数据时才发起查询，不用的时候不查询，又称按需加载（懒加载）</p>
<p>​        <strong>立即加载：</strong></p>
<p>​                不管用不用，只要调用方法，马上发起查询</p>
<p>​        <strong>一对多，多对多采用延迟加载</strong></p>
<p>​        <strong>一对一，多对一采用立即加载</strong></p>
<h2 id="二、MyBatis延迟加载的实现"><a href="#二、MyBatis延迟加载的实现" class="headerlink" title="二、MyBatis延迟加载的实现"></a>二、MyBatis延迟加载的实现</h2><p><strong>举例</strong>：</p>
<p>​        使用User与Account模型分别实现一对一与一对多的延迟加载</p>
<p><strong>核心思想：</strong></p>
<p>​        将sql语句中的多表关联查询改成单表查询，并在需要访问关联数据时，再通过按需查询的方式取出关联数据。</p>
<p><strong>一对一延迟加载实现：</strong></p>
<p>​        1.在sqlMapConfig.xml配置文件中打开延迟缓存的全局开关</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​        1.将account对象中的findAll方法的xml配置文件中的sql语句改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from account</span><br></pre></td></tr></table></figure>

<p>​        2.在IAccountDao.xml中的resultMap属性中的association中，我们不再配置id与result元素，而是添加select和colomn属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">property</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>——–&gt;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"user"</span> <span class="attr">select</span>=<span class="string">"com.itheima.dao.IUserDao.findUserById"</span> <span class="attr">colomn</span>=<span class="string">"uid"</span> &gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        3.保证IUserDao有findUserById方法及其实现即可</p>
<p><strong>一对多延迟加载实现：</strong></p>
<p>​        1.将User对象中的findAll方法的xml配置文件中的sql语句改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user</span><br></pre></td></tr></table></figure>

<p>​        2.在IUserDao.xml中的resultMap属性中的collection中，我们不再配置id和result元素，而是添加select和colomn属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id1"</span> <span class="attr">property</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"money"</span> <span class="attr">property</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>————&gt;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">type</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span> <span class="attr">select</span>=<span class="string">"com.itheima.dao.IAccountDao.findAccountByUid"</span> <span class="attr">colomn</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        3.保证在IAccountDao中有findAccountByUid方法及其实现</p>
<h2 id="三、MyBatis缓存"><a href="#三、MyBatis缓存" class="headerlink" title="三、MyBatis缓存"></a>三、MyBatis缓存</h2><p>​        像大多数的持久化框架一样，Mybatis 也提供了缓存策略，通过缓存策略来减少数据库的查询次数，从而提 高性能。</p>
<p>​        Mybatis 中缓存分为一级缓存，二级缓存。</p>
<p><strong>一级缓存：</strong></p>
<p>​    一级缓存是 SqlSession级别的缓存，只要SqlSession 没有 flush或 close，它就存在。</p>
<p><strong>一级缓存的清空</strong></p>
<p>​    当调用 SqlSession 的修改，添加，删除，commit()，close()等方法时，就会清空一级缓存。</p>
<p><strong>二级缓存</strong></p>
<p>​        二级缓存是 mapper 映射级别的缓存，多个 SqlSession 去操作同一个 Mapper 映射的 sql 语句，多个 SqlSession可以共用二级缓存，二级缓存是跨 SqlSession 的，但是保存的散装的数据，而不是完整的对象。</p>
<p><strong>二级缓存的开启与关闭：</strong></p>
<p>​        1.在sqlMapConfig中开启二级缓存</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启二级缓存的支持 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">因为 cacheEnabled 的取值默认就为 true，所以这一步可以省略不配置。为 true 代表开启二级缓存；为</span><br><span class="line">false代表不开启二级缓存。</span><br></pre></td></tr></table></figure>

<p>​        2.配置相关的Mapper映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.itheima.dao.IUserDao"</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 开启二级缓存的支持 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        3.配置statement上面的userCache属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!-- 根据 id查询 --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    select * from user where id = #&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">将UserDao.xml 映射文件中的<span class="tag">&lt;<span class="name">select</span>&gt;</span>标签中设置 useCache=”true”代表当前这个 statement要使用</span><br><span class="line">二级缓存，如果不使用二级缓存可以设置为false。 </span><br><span class="line">注意：针对每次查询都需要最新的数据 sql，要设置成 useCache=false，禁用二级缓存。</span><br></pre></td></tr></table></figure>

<h2 id="四、MyBatis的注解开发"><a href="#四、MyBatis的注解开发" class="headerlink" title="四、MyBatis的注解开发"></a>四、MyBatis的注解开发</h2><p>​        除了通过配置xml文件的方式，MyBatis还支持注解开发。使用注解可以简化开发，提高开发效率，但是当程序体积增大，使用注解相对更加难以维护。</p>
<p>​        <strong>注意事项：</strong></p>
<p>​            若要使用注解开发，就不能创建接口对应的xml文件，否则MyBatis将会报错。</p>
<p>​            而且注解开发在sqlMapConfig.xml中的Mapper中要配置class属性而不是resource属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">rescource</span>=<span class="string">"com/itheima/dao/IUserDao.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>———-&gt;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"com.itheima.dao.IUserDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​            或者使用package也可以</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.itheim.dao"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​            <strong>编写实现：</strong></p>
<p>​                注解开发可以省去接口对应的xml文件，采用在对应接口的方法前使用注解，并在注解括号中加入sql语句的方式来实现方法。</p>
<p>​                <strong>常用的注解有：</strong></p>
<blockquote>
<p>@Insert:实现新增</p>
<p>​                @Update:实现更新</p>
<p>​                @Delete:实现删除</p>
<p>​                @Select:实现查询 </p>
<p>​                @Result:实现结果集封装 </p>
<p>​                @Results:可以与@Result 一起使用，封装多个结果集 </p>
<p>​                @ResultMap:实现引用@Results 定义的封装 </p>
<p>​                @One:实现一对一结果集封装 </p>
<p>​                @Many:实现一对多结果集封装 </p>
<p>​                @SelectProvider: 实现动态SQL映射 </p>
<p>​                @CacheNamespace:实现注解二级缓存的使用</p>
</blockquote>
<p>​            <strong>1.注解开发实现CRUD操作示例：</strong></p>
<p>​            <strong>增：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 保存用户</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Insert</span>(<span class="string">"insert into user(username,birthday,sex,address)values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​            <strong>删：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 删除用户</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Delete</span>(<span class="string">"delete from user where id =#&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​            <strong>改：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 更新用户</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Update</span>(<span class="string">"update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id =#&#123;id&#125;"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​            <strong>查：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据id查找</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select</span>(<span class="string">"select * from user where id =#&#123;id&#125;"</span>)</span><br><span class="line">   <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据名称模糊查询</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select</span>(<span class="string">"select * from user where username like #&#123;username&#125;"</span>)</span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询总记录条数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select</span>(<span class="string">"select count(*) from user"</span>)</span><br><span class="line">   <span class="function">Integer <span class="title">totalCount</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>​            <strong>2.注解开发实现多表查询：</strong></p>
<p>​                多表查询通过注解开发也很容易实现，只需要配好@Results属性中的@Result中的@One或@Many即可。select属性配置从表被查询时会调用的方法，FetchType设置加载方式（延迟查询，立即查询）</p>
<p>​                <strong>一对一：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询所有账户</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select</span>(<span class="string">"select * from account"</span>)</span><br><span class="line">   <span class="meta">@Results</span>(id=<span class="string">"accountMap"</span>,value=&#123;</span><br><span class="line">           <span class="meta">@Result</span>(property = <span class="string">"user"</span>,column =<span class="string">"uid"</span>,one=<span class="meta">@One</span>(select=<span class="string">"com.itheima.dao.IUserDao.findById"</span>,fetchType = FetchType.EAGER))</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="function">List&lt;Account&gt; <span class="title">fndAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>​                <strong>一对多：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询所有用户</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">   <span class="meta">@Results</span>(id=<span class="string">"userMap"</span>,value=&#123;</span><br><span class="line">           <span class="meta">@Result</span>(id=<span class="keyword">true</span>,property = <span class="string">"id"</span>,column = <span class="string">"id"</span>),</span><br><span class="line">           <span class="meta">@Result</span>(property = <span class="string">"accounts"</span>,column=<span class="string">"id"</span>,many=<span class="meta">@Many</span>(select=<span class="string">"com.itheima.dao.IAccountDao.findByUid"</span>,fetchType = FetchType.LAZY))</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>​            <strong>3.注解开发使用二级缓存：</strong></p>
<p>​                不论是xml还是注解开发，一级缓存都是自动开启的。但是二级缓存，需要我们手动开启使用</p>
<p>​                开启步骤：</p>
<p>​                        （1）在sqlMapConfig.xml中开启全局二级缓存开关（自动开启，本步骤可省略）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置开启二级缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                            (2) 在要求开启的接口上开启二级缓存开关(写在整体接口前)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace</span>(blocking=<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>

<p>​                    开启完毕，直接使用即可</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/02/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/02/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">MyBatis学习笔记（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-02 09:22:23 / 修改时间：09:03:08" itemprop="dateCreated datePublished" datetime="2020-02-02T09:22:23+08:00">2020-02-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatis学习笔记-（一）"><a href="#MyBatis学习笔记-（一）" class="headerlink" title="MyBatis学习笔记  （一）"></a>MyBatis学习笔记  （一）</h1><p><strong>本系列笔记学习的是黑马程序员推出的ssm系列课程，感谢老师的精彩讲解，在此立贴以示感激。</strong></p>
<h2 id="一、MyBatis概述"><a href="#一、MyBatis概述" class="headerlink" title="一、MyBatis概述"></a>一、MyBatis概述</h2><p>​        MyBatis是一款优秀的Java持久层框架，它封装了JDBC，使开发者只需要关注Sql语句本身，二不需要花费精力去处理加载驱动，创建连接、创建Statement等繁杂的过程  </p>
<p>​        MyBatis通过xml或注解的方式将要执行的各种statement配置起来，并通过java对象和statement中sql的动态参数进行映射生成最终执行的sql语句，最后由MyBatis框架执行sql并将结果映射为java对象并返回。</p>
<p>​        采用ORM思想解决了实体和数据库映射的问题，对JDBC进行了封装，屏蔽了JDBC API底层访问细节，是我们不用与JDBC API打交道，就可以完成对数据库的持久化操作。</p>
<h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><h5 id="1-创建maven工程并导入坐标，即在pom-xml中添加依赖（包括mybatis，mysql，log4j，junit-："><a href="#1-创建maven工程并导入坐标，即在pom-xml中添加依赖（包括mybatis，mysql，log4j，junit-：" class="headerlink" title="1.创建maven工程并导入坐标，即在pom.xml中添加依赖（包括mybatis，mysql，log4j，junit)："></a>1.创建maven工程并导入坐标，即在pom.xml中添加依赖（包括mybatis，mysql，log4j，junit)：</h5><p><img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200128225556171.png" alt="image-20200128225556171"></p>
<h5 id="2-创建数据库表以及对应的Java实体类"><a href="#2-创建数据库表以及对应的Java实体类" class="headerlink" title="2.创建数据库表以及对应的Java实体类"></a>2.创建数据库表以及对应的Java实体类</h5><h5 id="3-创建dao接口"><a href="#3-创建dao接口" class="headerlink" title="3.创建dao接口"></a>3.创建dao接口</h5><p>​    <img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200128225845313.png" alt="image-20200128225845313"></p>
<h5 id="4-创建MyBatis的主配置文件（SqlMapConfig-xml"><a href="#4-创建MyBatis的主配置文件（SqlMapConfig-xml" class="headerlink" title="4.创建MyBatis的主配置文件（SqlMapConfig.xml):"></a>4.创建MyBatis的主配置文件（SqlMapConfig.xml):</h5><p>​                    <img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200128230044243.png" alt="image-20200128230044243"></p>
<p>​                </p>
<h5 id="5-创建映射配置文件（IUserDao-xml）："><a href="#5-创建映射配置文件（IUserDao-xml）：" class="headerlink" title="5.创建映射配置文件（IUserDao.xml）："></a>5.创建映射配置文件（IUserDao.xml）：</h5><p><img src="/.com//C:%5CUsers%5C24207%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200128230018307.png" alt="image-20200128230018307"></p>
<h5 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h5><p>​        <strong>1.在MyBatis中，dao常被成为Mapper</strong></p>
<p>​        <strong>2.包与目录的创建方式不同：</strong></p>
<p>​                例如：com.itheima.IUserDao以packege方式创建是三级目录，</p>
<p>​                                                                    以目录方式创建是一级目录。</p>
<p>​        <strong>3.MyBatis的映射文件和Dao接口的包结构必须相同。（即IUserDao.xml与IUserDao.java的包结构必须相同）</strong></p>
<p><img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200129085711766.png" alt="image-20200129085711766"></p>
<p>​        <strong>4.映射配置文件的mapper的namespace属性必须是dao接口的全限定类名</strong></p>
<p><img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200129085905528.png" alt="image-20200129085905528"></p>
<p>​        <strong>5.映射配置文件的操作配置id属性必须是dao接口的方法名</strong></p>
<p><img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200129085925224.png" alt="image-20200129085925224"></p>
<h2 id="三、入门案例"><a href="#三、入门案例" class="headerlink" title="三、入门案例"></a>三、入门案例</h2><pre><code>###      1.步骤：</code></pre><p><img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200129090754826.png" alt="image-20200129090754826"></p>
<h3 id="2-设计模式："><a href="#2-设计模式：" class="headerlink" title="2.设计模式："></a>2.设计模式：</h3><h3 id><a href="#" class="headerlink" title></a><img src="/.com//E:%5C%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93%5Cssm%E6%A1%86%E6%9E%B6%5C%E6%88%AA%E5%9B%BE%5Cimage-20200129090833062.png" alt="image-20200129090833062"></h3><h3 id="3-过程分析："><a href="#3-过程分析：" class="headerlink" title="3.过程分析："></a>3.过程分析：</h3><p>​        <strong>（1）解析主配置文件获取数据库连接：</strong></p>
<p>​                    MyBatis据此自动注册驱动，获取连接，创建connection对象<br>​        <strong>（2）解析映射配置文件：</strong></p>
<p>​                    获取执行的sql语句，MyBatis据此构造preparedStatement。</p>
<p>​        <strong>（3）执行查询操作：</strong></p>
<p>​                    ResultSet rs = preparedStatemnt.executeQuery();</p>
<p>​           <strong>(4) 遍历结果集并封装</strong></p>
<p>​                        List<E> list = new ArrayList ();</E></p>
<p>​                        while(rs.next()){</p>
<p>​                                        E  element = class.forName(配置的全限定类名（即resultType）).newInstance（）;</p>
<p>​                                        进行封装,把每个rs中的属性封装到element的属性之中</p>
<p>​                                        把element加入到list中</p>
<p>​                                        list.add(element);</p>
<p>​                        }</p>
<p>​                        <em>tip:在MyBatis中存在一个mapper对象，将Sql语句与封装结果的实体类全限定类名封装成一体</em></p>
<p>​                        <em>且存在一个map，用来保存实体类与其接口的对应关系。map的key为实体类的全限定类名（namespace属性）与接口的名称（id属性），value为sql语句与封装结果的全限定类名(resultType)</em>。  </p>
<p>​               <strong>(5)返回list</strong></p>
<p>​                </p>
<p>​        </p>
<p>​                    </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/02/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/02/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">MyBatis学习笔记（三）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-02 09:22:23 / 修改时间：08:56:23" itemprop="dateCreated datePublished" datetime="2020-02-02T09:22:23+08:00">2020-02-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatis学习笔记（三）"><a href="#MyBatis学习笔记（三）" class="headerlink" title="MyBatis学习笔记（三）"></a>MyBatis学习笔记（三）</h1><h2 id="一、MyBatis连接池"><a href="#一、MyBatis连接池" class="headerlink" title="一、MyBatis连接池"></a>一、MyBatis连接池</h2><pre><code>### 1.连接池：</code></pre><p>​        在实际开发中，连接池会得到广泛应用，因为它可以减少获取连接的时间</p>
<h2 id="2-MyBatis中的连接池"><a href="#2-MyBatis中的连接池" class="headerlink" title="2.MyBatis中的连接池"></a>2.MyBatis中的连接池</h2><p>​        MyBatis连接池提供3中方式的配置：</p>
<p>​                配置的位置：主配置文件SqlMapConfig.xml中的dataSource标签，type属性指定连接池的种类</p>
<p>​                type属性取值:</p>
<p>​                        POOLED            采用传统的javax.sql.DataSource规范中的连接池，MyBatis中有针对规范的实现</p>
<p>​                        UNPOOLED      采用传统的获取连接方式，虽然也实现了javax.sql.DataSource接口，但是并没有使用池的思想</p>
<p>​                        JNDI（*）        采用服务器提供的JNIDI技术实现，来获取DataSource对象，不同的服务器所能拿到的DataSource是不一样的，如果不是web或者maven的war工程，是不能使用的。</p>
<h2 id="二、MyBatis中的事务（-自学）"><a href="#二、MyBatis中的事务（-自学）" class="headerlink" title="二、MyBatis中的事务（*自学）"></a>二、MyBatis中的事务（*自学）</h2><p>1.事务是什么</p>
<p>2.事务的四大特性ACID</p>
<p>3.不考虑隔离性会产生的3个问题</p>
<p>4.解决办法，四种隔离级别</p>
<h2 id="三、MyBatis的事务自动提交"><a href="#三、MyBatis的事务自动提交" class="headerlink" title="三、MyBatis的事务自动提交"></a>三、MyBatis的事务自动提交</h2><p><strong>MyBatis通过sqlSession对象的commit方法和rollback方法实现事务的提交和回滚</strong></p>
<p><strong>事务提交可通过调用session.commit()来提交事务,也可以通过MyBatis实现自动事务提交</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session = factory.openSession();</span><br></pre></td></tr></table></figure>

<p>改成-&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session = factory.openSession(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>即可</p>
<h2 id="四、动态sql语句"><a href="#四、动态sql语句" class="headerlink" title="四、动态sql语句"></a>四、动态sql语句</h2><p>​    在处理条件查询时，使用JDBC是一件很痛苦的事情。MyBatis提供了一种动态Sql语句的方式，来解决这个问题。为了处理这个问题，MyBatis主要提供了一下几个标签：</p>
<h3 id="1-60-if-62-标签"><a href="#1-60-if-62-标签" class="headerlink" title="1.&#60;if&#62;标签"></a>1.&#60;if&#62;标签</h3><p>​    当查询方法传入了一个对象，要求根据对象的属性，查找数据库中与其匹配或相似的对象时，需要考虑该对象的部分属性为null或长度为0的问题。若直接用sql语句去写，很难处理。引入<if>标签之后，可以增加一层判断，该问题就迎刃而解了。</if></p>
<p>​    举例：在findByUser方法中，我们传入一个User对象，要求根据用户名模糊查询，根据地址精确查寻。在原sql语句后加入“where 1=1”,再对用户名与地址是否为空进行判断，即可放心地在sql语句后完成操作。具体操作如下：(user使用了typeAlias进行了别名转换)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span> = <span class="string">"findByUser"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameter</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from user where 1 =1 </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> =<span class="string">"username!=null &amp;&amp; username.length()!=0&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">        and username like #&#123;username&#125;</span></span></span><br><span class="line"><span class="tag"><span class="string">    &lt;/if&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">    &lt;if test ="</span><span class="attr">address</span>!=<span class="string">null</span>"&gt;</span></span><br><span class="line">    	and address = #&#123;address&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>         </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-60-where-62-标签"><a href="#2-60-where-62-标签" class="headerlink" title="2.&#60;where&#62;标签"></a>2.&#60;where&#62;标签</h3><p>​        简化where 1=1的条件拼装，可以采用<where>标签来简化开发</where></p>
<p>​        即用<where>标签可直接替换 where 1  = 1    </where></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span> = <span class="string">"findByUser"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameter</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">	select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> =<span class="string">"username!=null &amp;&amp; username.length()!=0&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">        	and username like #&#123;username&#125;</span></span></span><br><span class="line"><span class="tag"><span class="string">		&lt;/if&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">		&lt;if test ="</span><span class="attr">address</span>!=<span class="string">null</span>"&gt;</span></span><br><span class="line">			and address = #&#123;address&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-60-foreach-62-标签"><a href="#3-60-foreach-62-标签" class="headerlink" title="3.&#60;foreach&#62;标签"></a>3.&#60;foreach&#62;标签</h3><p>​        当传入多个id查询用户信息，会使用下列sql语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM USERS WHERE id IN (10,89,16)</span><br></pre></td></tr></table></figure>

<p>​        当id以一个集合的形式通过参数传递传递过来时，可以使用<foreach>标签，来遍历集合中的所有id，拼接完成sql语句。</foreach></p>
<p>​        具体实现：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有用户在 id的集合之中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findInIds"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameterType</span>=<span class="string">"queryvo"</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- select * from user where id in (1,2,3,4,5); --&gt;</span></span><br><span class="line">    select * from user </span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() &gt; 0"</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">open</span>=<span class="string">"id in ( "</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">item</span>=<span class="string">"uid"</span></span></span><br><span class="line"><span class="tag"><span class="attr">separator</span>=<span class="string">","</span>&gt;</span> #&#123;uid&#125; </span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><foreach>标签用于遍历集合，它的属性： </foreach></p>
<p>​        collection:代表要遍历的集合元素，注意编写时不要写#{} </p>
<p>​        open:代表语句的开始部分</p>
<p>​        close:代表结束部分</p>
<h3 id="4-60-sql-62-标签"><a href="#4-60-sql-62-标签" class="headerlink" title="4.  &#60;sql &#62; 标签"></a>4.  &#60;sql &#62; 标签</h3><p>​        将重复的sql语句通过<sql>标签进行打包定义，后边进行引用即可</sql></p>
<p>​        举例：</p>
<p>​        定义代码片段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 抽取重复的语句代码片段 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"defaultSql"</span>&gt;</span></span><br><span class="line">		select * from user	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        引用代码片段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置查询所有操作 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"defaultSql"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="五、MyBAtis多表查询之一对多"><a href="#五、MyBAtis多表查询之一对多" class="headerlink" title="五、MyBAtis多表查询之一对多"></a>五、MyBAtis多表查询之一对多</h2><p>​        <strong>举例：</strong></p>
<p>​            用户信息与账户信息是一个典型的一对多模型，一个用户可能拥有多个账户，但一个账户只能归于一个用户所有。</p>
<p>​        <strong>问题分析：</strong></p>
<p>​        我们要求实现：</p>
<p>​            查询用户信息时，可以得到用户所拥有的账户信息</p>
<p>​            查询账户信息时，可以得到账户所属的用户信息</p>
<p>​        <strong>实现步骤</strong></p>
<p>​            1.创建数据库用户表和账户表</p>
<p>​            2.创建用户实体类和账户实体类</p>
<p>​            3.创建用户配置信息和账户配置信息</p>
<p>​            4.完成配置</p>
<p>​         <strong>具体实现：</strong></p>
<p>​            <strong>账户到用户一对多</strong>：</p>
<p>​                    1.创建account表时需设置一个uid标识所属user对象</p>
<p>​                    2..在Account类中加入User子类，并生成Getter&amp;Setter&amp;toString方法</p>
<p>​                    3.IAccountDao中添加findAll方法</p>
<p>​                    4.配置xml文件，用代理dao方式实现接口：</p>
<p>​                            定义accountUserMap:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义封装account和user的resultMap --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountUserMap"</span> <span class="attr">type</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"aid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 一对一的关系映射，配置封装user的内容 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">property</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                            引用accountUserMap，并添加sql语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置查询所有--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"accountUserMap"</span>&gt;</span></span><br><span class="line">    select a.* ,u.*  from account a , user u where u.id=a.uid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​            <strong>用户到账户多对一</strong>：</p>
<p>​                    1.在User类中加入Account集合引用，并生成Getter&amp;Setter&amp;toString方法</p>
<p>​                    2.在接口中添加findAll方法</p>
<p>​                    3.配置xml文件，用代理dao方式实现接口：</p>
<p>​                            定义userAccountMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义User的resultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userAccountMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置User对象中accounts集合的映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id1"</span> <span class="attr">property</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"money"</span> <span class="attr">property</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                            引用userAccountMAp,并添加sql语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置查询所有--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userAccountMap"</span>&gt;</span></span><br><span class="line">        select * from user u left outer join account a on u.id=a.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="六、MyBatis多表查询之多对多"><a href="#六、MyBatis多表查询之多对多" class="headerlink" title="六、MyBatis多表查询之多对多"></a>六、MyBatis多表查询之多对多</h2><p>​        <strong>举例：</strong></p>
<p>​                用户信息与角色信息是一个典型的多对多模型，一个用户可能扮演多个角色，一个角色也可能被多个用户所扮演。</p>
<p>​        <strong>问题分析：</strong></p>
<p>​        我们要求实现：</p>
<p>​            查询用户信息时，可以得到用户所扮演的所有角色信息</p>
<p>​            查询角色信息时，可以得到角色所有的扮演者用户信息</p>
<p>​        <strong>实现步骤:</strong></p>
<p>​            1.创建数据库用户表和角色表以及<u><strong>中间关联表</strong></u></p>
<p>​            2.创建用户实体类和角色实体类</p>
<p>​            3.创建用户配置信息和角色配置信息</p>
<p>​            4.完成配置</p>
<p>​        <strong>具体实现:</strong></p>
<p>​            基本步骤与上类似，此处只贴出sql语句：</p>
<p>​                    角色到用户:              </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">        select u.*,r.id as rid,r.role_name,r.role_desc from role r</span><br><span class="line">         left outer join user_role ur on r.id = ur.rid</span><br><span class="line">         left outer join user u on u.id = ur.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                    用户到角色：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置查询所有--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">      select u.*,r.id as rid,r.role_name,r.role_desc from user u</span><br><span class="line">       left outer join user_role ur on u.id = ur.uid</span><br><span class="line">       left outer join role r on r.id = ur.rid</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/02/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BryantZk">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/02/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">MyBatis学习笔记（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-02 09:22:23 / 修改时间：08:57:07" itemprop="dateCreated datePublished" datetime="2020-02-02T09:22:23+08:00">2020-02-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatis学习笔记（二）"><a href="#MyBatis学习笔记（二）" class="headerlink" title="MyBatis学习笔记（二）"></a>MyBatis学习笔记（二）</h1><h2 id="一、MyBatis通过代理dao的方式实现CRUD操作"><a href="#一、MyBatis通过代理dao的方式实现CRUD操作" class="headerlink" title="一、MyBatis通过代理dao的方式实现CRUD操作"></a>一、MyBatis通过代理dao的方式实现CRUD操作</h2><h3 id="1-编写步骤"><a href="#1-编写步骤" class="headerlink" title="1.编写步骤"></a>1.编写步骤</h3><p>​        （1）在dao接口中创建相应的CRUD方法</p>
<p>​        （2）配置xml文件：</p>
<p>​                    选择正确的标签（select insert update delete）</p>
<p>​                    配置id，resultType，parameter属性</p>
<p>​                    配置sql语句</p>
<p>​        （3）使用代理dao调用方法即可</p>
<h3 id="2-parameter属性分析"><a href="#2-parameter属性分析" class="headerlink" title="2.parameter属性分析"></a>2.parameter属性分析</h3><p>​            <strong>parameter属性可以设置成三种类型：简单类型，pojo对象，pojo的封装对象</strong></p>
<pre><code>### （1）简单类型</code></pre><p>​                直接传入简单类型名即可，不区分大小写</p>
<h3 id="（2）pojo对象"><a href="#（2）pojo对象" class="headerlink" title="（2）pojo对象"></a>（2）pojo对象</h3><p>​                传入对象的全限定类名。</p>
<p>​                由于MyBatis使用ognl表达式解析对象字段的值，在sql语句引用对象中的属性值时，可省略<strong>对象名.属性名</strong>的写法，直接写<strong>属性名</strong>即可</p>
<h3 id="（3）pojo包装对象"><a href="#（3）pojo包装对象" class="headerlink" title="（3）pojo包装对象"></a>（3）pojo包装对象</h3><p>​                有时查询需要用到不止一个对象的信息，则可以将多个对象封装在一个包装对象中，进行传递。</p>
<h2 id="二、实体类属性与表列名不同时的转换处理"><a href="#二、实体类属性与表列名不同时的转换处理" class="headerlink" title="二、实体类属性与表列名不同时的转换处理"></a>二、实体类属性与表列名不同时的转换处理</h2><p>​    举例：在实体类中，User的属性为userId，userName，userAddress</p>
<p>​                在数据库表中，User表的属性为id，username，address。</p>
<p>​                如果不进行一致性转换，那么resultset在封装的时候，会找不到封装目标属性，导致封装失败。</p>
<p>​                一致性转换有以下两种方法    </p>
<p><strong>1.改写sql语句，进行直接转换:</strong>  (执行效率更高)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user</span><br></pre></td></tr></table></figure>

<p>​    -&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id as userId, username as userName, address as userAdress from user</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>as 前时数据库表的列名，as后时java实体类的属性名</strong></p>
<p><strong>2.在映射配置文件(IUserDao.xml)中配置resultMap属性</strong>:（开发效率更高）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span> = <span class="string">"userMap"</span> <span class="attr">type</span> = <span class="string">"com.itheima.domain.User"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 主键字段的对应 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"userId"</span> <span class="attr">colomn</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 非主键字段的对应 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">colomn</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userAddress"</span> <span class="attr">colomn</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>然后在下面的各个有返回类型属性配置的sql语句配置中，使用resultMap代替resultType：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">select * form user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="三、property标签的使用"><a href="#三、property标签的使用" class="headerlink" title="三、property标签的使用"></a>三、property标签的使用</h2><p><strong>在配置数据库连接池的过程中需要用到property属性</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置数据源(连接池) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 配置连接数据库的基本信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/test?serverTimezone=UTC"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>也可以通过外联配置文件的方式来进行配置，此时需用properties标签指定外联配置文件的路径，再将property中的value改成引用的形式即可</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- jdbcConfig.properties中指定了数据库连接所需的driver,url,username,password等属性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span> = <span class="string">"jdbcConfig.properties"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置数据源(连接池) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 配置连接数据库的基本信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">“$&#123;jdbc.driver&#125;”</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、typeAlias与packege标签的使用"><a href="#四、typeAlias与packege标签的使用" class="headerlink" title="四、typeAlias与packege标签的使用"></a>四、typeAlias与packege标签的使用</h2><p><strong>typeAlias标签用于配置domain中类的别名，即可将全限定类名配置别名，使其使用更加简单</strong>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- type指定实体类的全限定类名，name指定别名 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置别名之后，使用别名可以不再区分大小写 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typealias</span> <span class="attr">type</span>=<span class="string">"com.itheim.domain.user"</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span><span class="tag">&lt;/<span class="name">typealias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>标签用于指定要配置别名的包，当指定之后，该包下的实体类都会注册别名，并且别名就是类名。</strong></p>
<p><strong>同样，别名不再区分大小写</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.itheima.domain"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置之后，domain下的所有实体类都被配置了别名，例如com.itheima.domain.user的别名为user--&gt;</span></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BryantZk</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BryantZk</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
